<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="中间件, 高可用, 架构, 读书"><title>架构演化的思路 | Lost</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?5c504f7ca80d4d57db5434656761512d";
var s = document.getElementsByTagName("script")[0]; 
s.parentNode.insertBefore(hm, s);
})();
</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">架构演化的思路</h1><a id="logo" href="/.">Lost</a><p class="description">朽骨暗夜，侯多时，你已徘徊多远?</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/favorite/"><i class="fa fa-star"> 收藏</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://lishoubo.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/思考/">思考</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书/">读书</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/tags/GC/" style="font-size: 15px;">GC</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/高可用/" style="font-size: 15px;">高可用</a> <a href="/tags/性能/" style="font-size: 15px;">性能</a> <a href="/tags/文件/" style="font-size: 15px;">文件</a> <a href="/tags/PageCache/" style="font-size: 15px;">PageCache</a> <a href="/tags/实时处理/" style="font-size: 15px;">实时处理</a> <a href="/tags/大数据/" style="font-size: 15px;">大数据</a> <a href="/tags/flink/" style="font-size: 15px;">flink</a> <a href="/tags/netty/" style="font-size: 15px;">netty</a> <a href="/tags/问题排查/" style="font-size: 15px;">问题排查</a> <a href="/tags/问题排除/" style="font-size: 15px;">问题排除</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/压测/" style="font-size: 15px;">压测</a> <a href="/tags/内存/" style="font-size: 15px;">内存</a> <a href="/tags/学习/" style="font-size: 15px;">学习</a> <a href="/tags/Netty/" style="font-size: 15px;">Netty</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/工具/" style="font-size: 15px;">工具</a> <a href="/tags/稳定性/" style="font-size: 15px;">稳定性</a> <a href="/tags/科幻/" style="font-size: 15px;">科幻</a> <a href="/tags/心理/" style="font-size: 15px;">心理</a> <a href="/tags/一般/" style="font-size: 15px;">一般</a> <a href="/tags/思考/" style="font-size: 15px;">思考</a> <a href="/tags/小说/" style="font-size: 15px;">小说</a> <a href="/tags/推荐/" style="font-size: 15px;">推荐</a> <a href="/tags/历史/" style="font-size: 15px;">历史</a> <a href="/tags/人类/" style="font-size: 15px;">人类</a> <a href="/tags/思维/" style="font-size: 15px;">思维</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08/25/一次CMS问题排除/">一次CMS问题排除</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/11/架构演化的思路/">架构演化的思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/29/核心链路的稳定性/">核心链路的稳定性</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/16/内网HTTP请求触发限流的排查/">内网HTTP请求触发限流的排查</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/15/全链路压测的大概思路/">全链路压测的大概思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/02/一个加锁粒度引起的问题/">一个加锁粒度引起的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/03/关于Netty的OutOfDirectMemoryError/">关于Netty的OutOfDirectMemoryError</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/23/读书-活着/">读书-活着</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/23/两阶段加锁/">两阶段加锁</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/27/MappedByteBuffer的一点优化/">MappedByteBuffer的一点优化</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 链接</i></div><ul></ul><a href="http://jm.taobao.org" title="阿里中间件团队博客" target="_blank">阿里中间件团队博客</a><ul></ul><a href="http://martin.kleppmann.com/" title="分布式专家Martin的博客" target="_blank">分布式专家Martin的博客</a><ul></ul><a href="http://www.mdjs.info/" title="水东居士的茶水间，偏大数据方面" target="_blank">水东居士的茶水间，偏大数据方面</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">架构演化的思路</h1><div class="post-meta">Aug 11, 2018<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>最近我们在讨论B端和C端的整体架构，收获不少，本文就共性的东西总结一下，指导后面其他架构的演化。</p>
<h3 id="任何脱离业务的架构都是耍流氓"><a href="#任何脱离业务的架构都是耍流氓" class="headerlink" title="任何脱离业务的架构都是耍流氓"></a>任何脱离业务的架构都是耍流氓</h3><p>相信我们都听过这句话，评价一个架构的好坏，一定要讨论背后所支撑的业务；而业务并不是一开始就是这个样子，业务是一天天累积扩大的，那么架构也应该是逐渐演化的。那如何让架构进行演化呢？</p>
<p>经过我们几轮的讨论，我觉得可以抽取的一个模式如下图：</p>
<p><img src="/images/tech/arch-01.png" alt=""></p>
<p>从一线开发，到架构设计，上线，再到一线开发进行验证，形成一个有效的闭环，推动整体架构的逐渐演化。</p>
<h4 id="一线开发的问题收集"><a href="#一线开发的问题收集" class="headerlink" title="一线开发的问题收集"></a>一线开发的问题收集</h4><p>一个好的架构一定不要凭空去想，在纸上画出的架构会有下面的问题：</p>
<ul>
<li>没有真正碰到问题的根源</li>
<li>没法发现隐藏的问题</li>
<li>画出的架构只是看起来好看，不解决实际问题</li>
</ul>
<p>所以，进行架构的第一步应该踏踏实实的，召集一线的开发，听取他们的反馈，收集他们在日常的开发中遇到的问题。讨论的时候可以聚焦到下面几个方向：</p>
<ul>
<li>重复代码多不多</li>
<li>发布频率是多少</li>
<li>新的需求改动大不大</li>
<li>数据量多少？QPS多少？</li>
<li>稳定性有没有保障</li>
<li>代码量有多少？</li>
<li>。。。</li>
</ul>
<p>基本上，这个环境就是让开发主动说一些实际的问题，不过不要忘了稳定性方面的工作。</p>
<h4 id="范围内方向讨论"><a href="#范围内方向讨论" class="headerlink" title="范围内方向讨论"></a>范围内方向讨论</h4><p>听完开发的问题，可以组织进行一个小范围内的讨论，将问题归类，然后，找出一个大概的方向。当问题讨论清楚后，方向其实比较好找，比如：</p>
<ul>
<li>模块的拆分</li>
<li>模块的合并</li>
<li>引入异步机制</li>
<li>引入分布式事务</li>
<li>服务化，平台化</li>
<li>插件化</li>
<li>引入规则引擎</li>
<li>拆表</li>
<li>数据同步</li>
<li>数据隔离</li>
<li>离线任务vs实时计算</li>
<li>。。。</li>
</ul>
<p>这个地方需要注意的是，<strong><em>方向性的问题一定要一定范围内找人讨论</em></strong>，避免出现下面的问题：</p>
<ul>
<li>不跟别人讨论，一个人闷头苦想。因为一个人的力量比较有限，或者当时就是忽略了某个点导致方向选择错误，所以一定要拉几个人，特别是相关模块的owner，一起看看想想；</li>
<li>拉太多的人讨论，结果很难形成结论。这个阶段重要的是要确定方向，所以避免又回到一堆人“发牢骚”的场景。</li>
</ul>
<h4 id="方案的设计"><a href="#方案的设计" class="headerlink" title="方案的设计"></a>方案的设计</h4><p>有了方向，接下来就是具体方案设计。方案设计的时候，要考虑清楚下面几点：</p>
<ul>
<li>方案的目标是不是跟第二部讨论的访问保持一致</li>
<li>方案的边界是否清晰：不要设计一个大而全的方案，明确方案或者系统的边界</li>
<li>考虑方案的时候，也要考虑人员的安排：这是比较实际的问题，也要考虑清楚。</li>
</ul>
<h4 id="方案的验证"><a href="#方案的验证" class="headerlink" title="方案的验证"></a>方案的验证</h4><p>方案落地后，不要忘了再找一线的开发手机反馈，验证一下当初第一步收集的问题是否解决了，是否有新的问题，或者问题解决的不彻底。这个地方要注意的是：</p>
<ul>
<li>并不是所有问题都解决的方案才是好方案：能解决问题就行，需要在时间，资源，收益之间做权衡</li>
<li>方案本身也是演进的，所以，方案落地后，就要开始继续收集问题，开始下一次迭代了。</li>
</ul>
<h4 id="考虑时间因素"><a href="#考虑时间因素" class="headerlink" title="考虑时间因素"></a>考虑时间因素</h4><p>另外要考虑的一个因素就是时间因素，因为，业务有的时候领先于先于架构：比如一些纯业务系统，只有业务慢慢上去问题才会暴漏，然后为了避免更多问题的出现我们开始优化架构；而有的场景，比如，稳定性，性能等，架构要优于业务提前考虑（至少提前一个季度），避免业务上去之后系统扛不住。</p>
<h4 id="架构里面的分分合合"><a href="#架构里面的分分合合" class="headerlink" title="架构里面的分分合合"></a>架构里面的分分合合</h4><p>架构里面经常的面临的问题就是分分合合：有的模块过于庞大需要拆解，有的模块过于简单需要合并，基本上，我们在考虑设计的时候会按照下面的模式思考系统划分：</p>
<p><img src="/images/tech/arch-02.png" alt=""></p>
<ol>
<li>系统词：这个时候是单体应用阶段，或者最初的大而全的系统，基本上按照明显的系统划分，比如，订单系统，交易系统等等</li>
<li>业务名词：当系统膨大到我们都觉得需要拆分的时候，接下来就开始按照业务名词拆分了，这个时候，这些业务是原来大而全的业务的一个子集，例如，订单系统的评价，店铺系统的详情页面，这种拆分有利于简化原来系统的逻辑，进一步专注于个别的业务流程</li>
<li>抽象名词：当一些明显的业务子集被抽取后，往往还是发现系统过于庞大，比如：发布集中到一部分代码，或者每次发布都受制于某一部分逻辑，这个时候，就要发现业务名词之外的东西了：抽象逻辑。抽象逻辑比较隐蔽，不像业务名词那么好发现，但是，一旦挖掘出来，往往对系统的架构有很好的调整，例如，人员管理系统的酬薪计算模块，工单系统的派单模块，这些都是将抽象的逻辑进行细化和剥离，实现整个系统的优化。</li>
</ol>
<h4 id="B端系统和C端系统的技术方向"><a href="#B端系统和C端系统的技术方向" class="headerlink" title="B端系统和C端系统的技术方向"></a>B端系统和C端系统的技术方向</h4><p>这次讨论给我一个特别的提示就是，B端系统和C端系统的技术方向上有一个显著的区别，这个区别指导着我们怎么去做B端和C端的技术规划：</p>
<ul>
<li>C端系统侧重于稳定性</li>
<li>B端系统侧重于效率</li>
</ul>
<p>最近面试了一堆人，基本都C端小伙伴，这个时候面试的思路就是怎么解决一些技术难点，怎么保障线上稳定性，其中有几个是一直做B端的，面试的时候对于性能稳定性了解的明显不够，当时就想：那应该怎么去面试B端的同学呢？</p>
<p>经过这次讨论，突然觉得做B的业务就是要解决效率问题：</p>
<ol>
<li>解决营业的效率</li>
<li>解决商家的效率</li>
<li>解决运维（线下）的效率</li>
<li>。。。</li>
</ol>
<p>效率对B端而已，就跟稳定性对于C端一样，都是时刻都要关注的，例如，我们是做单车的，那么，作为B端的小伙伴就要解决：</p>
<ol>
<li>单车能够尽快的投入到地面</li>
<li>单车投入地面以后要能高效的运维，</li>
<li>单车故障后维修师傅要能尽快的进行发现和维修</li>
<li>。。。</li>
</ol>
<p>这样以来，B端的技术方向和考核点就会比较清楚。</p>
<h4 id="团队的技术发展规划"><a href="#团队的技术发展规划" class="headerlink" title="团队的技术发展规划"></a>团队的技术发展规划</h4><p>在讨论架构的时候，渐渐的理清楚了团队的技术发展规划，以前做中间件的时候思考了一部分，现在更加完善了一下：</p>
<p><img src="/images/tech/arch-03.png" alt=""></p>
<p>基本上，按照时间和团队规模进行演化：</p>
<ol>
<li>服务化：这个时候，团队提供最基本的服务能力，能够完成产品，运营和公司的KPI</li>
<li>产品化：按照业务或者产品，将某些服务进行组合或者深挖，提供对外的产品</li>
<li>平台化：做的更深入之后，开始做平台，适配各种业务场景，提供整个链路的解决方案</li>
<li>领域化：让团队成员深耕一个领域，成为某个领域的专家</li>
<li>数据化：提供服务能力只是帮别人解决问题，下一步要发展的就是引导别人发现问题，这就需要数据化，通过数据的分析，指导业务发展的方向。</li>
</ol>
<p>当然，并不是严格按照时间先后进行演化，不过基本上在做规划做设计的时候，都要考虑目前团队处于哪一个阶段，团队成员处于哪一个阶段。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://lishoubo.github.io/2018/08/11/架构演化的思路/" data-id="cjl96jd2j001m5nzvq4ji7tsb" class="article-share-link">分享到</a><div class="tags"><a href="/tags/架构/">架构</a></div><div class="post-nav"><a href="/2018/08/25/一次CMS问题排除/" class="pre">一次CMS问题排除</a><a href="/2018/07/29/核心链路的稳定性/" class="next">核心链路的稳定性</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© 如果，我有能力，可以让时间倒流。。。 </div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>